# TODO: Escaping double curly braces in Ansible https://stackoverflow.com/questions/32279519/escaping-double-curly-braces-in-ansible

versions:
  asdf: v0.9.0
  gcloud: 375.0.0
  golang: 1.17.8
  grafana: 9.1.3
  kubectl: v1.26.0
  nodejs: 17.6.0
  python: 3.10.0
  ruby: 3.1.0
  rust: 1.59.0
  stew: v0.3.0
  terraform: 1.1.8
  packer: 1.8.0
  php: 8.0.2

tag: []
output: ""
# ROLE COMPONENT
role_component:
  # pip:
  #   virtualenv: ""
  backup: true
  render_dir: "{{ playbook_dir }}/component_rendered_tasks"
  yaml_with_includes: true
  force_restart:  false
  ignore_errors:  true
  user:   "{{ ansible_user }}"
  group:  "{{ ansible_user }}"
  mode:   644
  run:    systemd

  components:
    - git
    - asdf
    - alacritty

  dummy:
    name: "Dummy component - used for testing"
    install:
      # become: false
      packages:
        - git
    configs:
      templates:
        - name: dummy
          template: dummy.yaml
          dest: ~/.config/dummy.yaml
          # group: staff
          variables:
            foo: bar

  git:
    name: git
    install:
      packages:
        - git
    configs:
      templates:
        - name: gitconfig
          template: "gitconfig"
          dest: "~/.gitconfig"
          variables:
            aliases:
              - p = push
              - st = status -sb
              - ll = log --oneline
              - last = log -1 HEAD --stat
              - cm = commit -m
              - rv = remote -v
              - d = diff
              - dv = difftool -t vimdiff -y
              - gl = config --global -l
              - se = !git rev-list --all | xargs git grep -F

  alacritty:
    name: "Alacritty - GPU Terminal"
    install:
      pre:
        - name: "[alacritty] deps"
          package:
            name: "{{'{{'}} item {{'}}'}}"
            state: present
          loop:
            - cmake
            - cargo
          become: true
      post:
        - name: "[alacritty] cargo install"
          shell: cargo install alacritty
    configs:
      templates:
        - name: alacritty
          template: alacritty.yml
          dest: "~/.config/alacritty/alacritty.yml"
          variables:
            font_size: 10.0

  asdf:
    name: "ASDF - Manage multiple runtime versions with a single CLI tool"
    install:
      pre:
        - name: "[asdf] system deps"
          # https://github.com/pyenv/pyenv/wiki#suggested-build-environment
          package:
            name: "{{'{{'}} item {{'}}'}}"
            state: present
          loop:
            - autoconf
            - bison
            - build-essential
            - curl
            - gettext
            - git
            - libbz2-dev
            - libcurl4-openssl-dev
            - libedit-dev
            - libffi-dev
            - libgd-dev
            - libicu-dev
            - libjpeg-dev
            - liblzma-dev
            - libmysqlclient-dev
            - libncursesw5-dev
            - libonig-dev
            - libpng-dev
            - libpq-dev
            - libreadline-dev
            - libsqlite3-dev
            - libssl-dev
            - libxml2-dev
            - libxmlsec1-dev
            - libzip-dev
            - llvm
            - make
            - openssl
            - pkg-config
            - re2c
            - tk-dev
            - unzip
            - wget
            - xz-utils
            - zlib1g-dev
          become: true
        - name: "[asdf] install via git"
          git:
            repo: https://github.com/asdf-vm/asdf.git
            dest: ~/.asdf
            version: "{{'{{'}} versions.asdf {{'}}'}}"
    configs:
      pre:
        - name: "[asdf] install repos"
          shell: |
            asdf plugin add {{'{{'}} item {{'}}'}} || echo "Already added?"
          environment:
            PATH: "{{'{{'}} ansible_env.HOME {{'}}'}}/.asdf/bin:{{'{{'}} ansible_env.PATH {{'}}'}}"
          loop:
            - "ruby https://github.com/asdf-vm/asdf-ruby.git"
            - "nodejs https://github.com/asdf-vm/asdf-nodejs.git"
            - "python https://github.com/danhper/asdf-python"
            - "golang https://github.com/kennyp/asdf-golang.git"
            - "gcloud https://github.com/jthegedus/asdf-gcloud"
            - "php https://github.com/asdf-community/asdf-php.git"
            - "rust https://github.com/asdf-community/asdf-rust.git"
            - "packer https://github.com/asdf-community/asdf-hashicorp.git"
            - "terraform https://github.com/asdf-community/asdf-hashicorp.git"
        - name: "[asdf] install plugins"
          # TODO: set version
          shell: |
            asdf install {{'{{'}} item {{'}}'}}
            asdf global  {{'{{'}} item {{'}}'}}
          environment:
            PATH: "{{'{{'}} ansible_env.HOME {{'}}'}}/.asdf/bin:{{ ansible_env.HOME }}/.asdf/shims:{{ ansible_env.PATH }}:{{'{{'}} ansible_env.PATH {{'}}'}}"
          loop:
            - "ruby   {{'{{'}} versions.ruby {{'}}'}}"
            - "nodejs {{'{{'}} versions.nodejs {{'}}'}}"
            - "python {{'{{'}} versions.python {{'}}'}}"
            - "golang {{'{{'}} versions.golang {{'}}'}}"
            - "gcloud {{'{{'}} versions.gcloud {{'}}'}}"
            - "php    {{'{{'}} versions.gcloud {{'}}'}}"
            - "rust   {{'{{'}} versions.rust   {{'}}'}}"
            - "packer {{'{{'}} versions.packer {{'}}'}}"
            - "terraform {{'{{'}} versions.terraform {{'}}'}}"
