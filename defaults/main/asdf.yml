role_component:
  asdf:
    name: "ASDF - Manage multiple runtime versions with a single CLI tool"
    install:
      pre:
        - name: "[asdf] system deps"
          # https://github.com/pyenv/pyenv/wiki#suggested-build-environment
          package:
            name: "{{'{{'}} item {{'}}'}}"
            state: present
          loop:
            - autoconf
            - bison
            - build-essential
            - curl
            - gettext
            - git
            - libbz2-dev
            - libcurl4-openssl-dev
            - libedit-dev
            - libffi-dev
            - libgd-dev
            - libicu-dev
            - libjpeg-dev
            - liblzma-dev
            - libmysqlclient-dev
            - libncursesw5-dev
            - libonig-dev
            - libpng-dev
            - libpq-dev
            - libreadline-dev
            - libsqlite3-dev
            - libssl-dev
            - libxml2-dev
            - libxmlsec1-dev
            - libzip-dev
            - llvm
            # - locate
            - make
            - openssl
            - pkg-config
            - re2c
            - tk-dev
            - unzip
            - wget
            - xz-utils
            - zlib1g-dev
          become: true
        - name: "[asdf] install via git"
          git:
            repo: https://github.com/asdf-vm/asdf.git
            dest: ~/.asdf
            version: "{{'{{'}} versions.asdf {{'}}'}}"
    configs:
      pre:
        - name: "[asdf] install repos"
          shell: |
            asdf plugin add {{'{{'}} item {{'}}'}} || echo "Already added?"
          environment:
            PATH: "{{'{{'}} ansible_env.HOME {{'}}'}}/.asdf/bin:{{'{{'}} ansible_env.PATH {{'}}'}}"
          loop:
            - "ruby https://github.com/asdf-vm/asdf-ruby.git"
            - "nodejs https://github.com/asdf-vm/asdf-nodejs.git"
            - "python https://github.com/danhper/asdf-python"
            - "golang https://github.com/kennyp/asdf-golang.git"
            - "gcloud https://github.com/jthegedus/asdf-gcloud"
            # - "php https://github.com/asdf-community/asdf-php.git" # BROKEN
            - "rust https://github.com/asdf-community/asdf-rust.git"
            - "packer https://github.com/asdf-community/asdf-hashicorp.git"
            - "terraform https://github.com/asdf-community/asdf-hashicorp.git"
        - name: "[asdf] install plugins"
          # TODO: set version
          shell: |
            asdf install {{'{{'}} item {{'}}'}}
            asdf global  {{'{{'}} item {{'}}'}}
          environment:
            PATH: "{{'{{'}} ansible_env.HOME {{'}}'}}/.asdf/bin:{{ ansible_env.HOME }}/.asdf/shims:{{ ansible_env.PATH }}:{{'{{'}} ansible_env.PATH {{'}}'}}"
          loop:
            - "ruby   {{'{{'}} versions.ruby {{'}}'}}"
            - "nodejs {{'{{'}} versions.nodejs {{'}}'}}"
            - "python {{'{{'}} versions.python {{'}}'}}"
            - "golang {{'{{'}} versions.golang {{'}}'}}"
            - "gcloud {{'{{'}} versions.gcloud {{'}}'}}"
            # - "php    {{'{{'}} versions.gcloud {{'}}'}}" # BROKEN
            - "rust   {{'{{'}} versions.rust   {{'}}'}}"
            - "packer {{'{{'}} versions.packer {{'}}'}}"
            - "terraform {{'{{'}} versions.terraform {{'}}'}}"
